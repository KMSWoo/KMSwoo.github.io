(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{684:function(t,s,a){"use strict";a.r(s);var n=a(47),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("初接触CSS的时候觉得很简单，不就是个指哪打哪的样式么，然后写了一段时间以后，发现CSS是个让你“按下葫芦起了瓢”的顽童，这不之前好好的sticky效果又莫名其妙的不sticky了。")]),t._v(" "),a("h2",{attrs:{id:"position-sticky-生效的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#position-sticky-生效的原理"}},[t._v("#")]),t._v(" position-sticky 生效的原理")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.w3.org/TR/css-position-3/#stickypos-scroll",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 W3 官方文档中的定义是"),a("OutboundLink")],1),t._v("：Sticky positioning is similar to relative positioning except the offsets are automatically calculated in reference to the nearest scrollport.")]),t._v(" "),a("p",[t._v("转换成通俗的大白话就是，Sticky 定位类似于相对定位，（当它表现为 fixed 定位的特性时）会根据最近的滚动容器（nearest scrollport）自动计算偏移量。")]),t._v(" "),a("p",[t._v("其中有一个非常重要的概念就是 nearest scrollport，它表示 sticky 元素在即将消失前会相对它最近的 scrollport 去做定位。")]),t._v(" "),a("h2",{attrs:{id:"正常的情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正常的情况"}},[t._v("#")]),t._v(" 正常的情况")]),t._v(" "),a("p",[t._v("所以正常而言，类似下面的这种情况，sticky 是可以正常展示的。")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" - 可滚动的容器 scrollport\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sticky"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  - 设置了 sticky 的元素\n")])])]),a("h2",{attrs:{id:"失效的-position-sticky"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#失效的-position-sticky"}},[t._v("#")]),t._v(" 失效的 position: sticky")]),t._v(" "),a("h3",{attrs:{id:"_1、包裹的父容器高度与-sticky-元素一致"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、包裹的父容器高度与-sticky-元素一致"}},[t._v("#")]),t._v(" 1、包裹的父容器高度与 sticky 元素一致")]),t._v(" "),a("p",[t._v("有趣的是，如果在 .sticky 元素和你希望 .sticky 生效吸附的滚动元素中间，添加上一层 .parent 的 div 元素，不给 div 添加任何样式，sticky 则失效了。")]),t._v(" "),a("p",[t._v("譬如是这样：")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   - 可滚动的容器 scrollport    \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("parent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("     \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sticky"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  - 设置了 sticky 的元素\n")])])]),a("p",[t._v("失效原因：此时 .sticky 元素的最近的 scrollport 变成了它的父容器 div，而父容器 div 的高度和 .sticky 元素的高度是一样的，所以表现不出 fixed 的特性。")]),t._v(" "),a("p",[t._v("其实，这里不算失效，我们只需要将包裹 .sticky 元素的父容器的高度设置的大于 .sticky 元素本身，也能看到效果。")]),t._v(" "),a("p",[t._v("譬如，我们可以加上")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(".parent {  height: 100vh;}\n")])])]),a("p",[t._v("此时，sticky 将重新生效")]),t._v(" "),a("p",[t._v("其实，造成这种现象的本质原因是，设置了 position: sticky 的元素吸附的基准元素从 .container 变成了 .parent 。")]),t._v(" "),a("h3",{attrs:{id:"_2、包裹的父容器设置了-overflow-hidden"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、包裹的父容器设置了-overflow-hidden"}},[t._v("#")]),t._v(" 2、包裹的父容器设置了 overflow: hidden")]),t._v(" "),a("p",[t._v("第二种情况，也会导致 position: sticky 的 fixed 定位特性失效。也就是 .sticky 元素的祖先容器存在 overflow: hidden。类似这样")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   - 可滚动的容器 scrollport    \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hidden"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("   - 设置了 overflow: hidden     \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("sticky"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("  - 设置了 sticky 的元素\n")])])]),a("p",[t._v("在上面这个 DEMO 里面，设置了 sticky 的元素的父元素 hidden 元素，它的高度是远比 stikcy 元素高的，但是滚动的过程中却没有表现出 fixed 的特性。")]),t._v(" "),a("p",[t._v("原因在于，设置了 overflow: hidden 的元素，它不再代用滚动的特性，当 sticky元素吸附于.hidden元素的顶部时，它随着 .hidden 元素本身在 container 移动。所以，所有的 sticky 元素都会被滚动出 container 的滚动区域。")]),t._v(" "),a("p",[t._v("当然，这里有一点比较奇怪的是，.sticky 元素相对 .hidden 元素进行 fixed 定位，而不是相对 .container 元素进行 fixed 定位，表面设置了 overflow: hidden 的元素，它也是一个 scrollport。")]),t._v(" "),a("p",[t._v("其实，不止是 overflow: hidden ，设定为 position: sticky 元素的任意父节点的 overflow 属性必须是 visible，否则 position:sticky 不会生效。")]),t._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),a("p",[t._v("看完上面几个 DEMO，可以好好总结一下 position:sticky 的生效规则，明白了生效规则就会知道为什么有的时候设定的 sticky 会失效：")]),t._v(" "),a("ol",[a("li",[t._v("须指定 top, right, bottom 或 left 四个阈值其中之一（且达到设定的阈值），才可使粘性定位生效。否则其行为与相对定位相同\n"),a("ul",[a("li",[t._v("并且 top 和 bottom 同时设置时，top 生效的优先级高，left 和 right 同时设置时，left 的优先级高")])])]),t._v(" "),a("li",[t._v("设定为 position: sticky 的元素的任意父节点的 overflow 属性必须是 visible，否则 position:sticky 不会生效\n"),a("ul",[a("li",[t._v("如果 position: sticky 元素的"),a("strong",[t._v("任意父节点")]),t._v("定位设置为 position: overflow，则父容器无法进行滚动，所以 position:sticky 元素也不会有滚动然后固定的情况")])])]),t._v(" "),a("li",[t._v("在满足上述情况下，设定了 position: sticky 的元素的父容器的高度必须大于当前元素，否则也会失效。（当然，此时，sticky 吸附的基准元素就会变成父元素）")])]),t._v(" "),a("hr")])}),[],!1,null,null,null);s.default=e.exports}}]);